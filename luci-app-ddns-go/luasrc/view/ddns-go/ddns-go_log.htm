<%+header%>
<div class="cbi-map">
    <h2 name="content"><%:DDNS-GO Log%></h2>
    <div class="cbi-section">
        <div class="cbi-section-descr">
            <input type="button" class="btn cbi-button cbi-button-apply" value="<%:Clear Log%>" onclick="clearLog()">
            <input type="button" class="btn cbi-button cbi-button-apply" value="<%:Stop Refresh%>" onclick="toggleRefresh()">
        </div>
        <div id="log_text" style="width: 100%; height: 500px; overflow: auto;"></div>
    </div>
</div>

<script type="text/javascript">
var refreshInterval;

function fetchLog() {
    XHR.get('<%=url("admin/services/ddns-go/fetch_log")%>', null, function(x, data) {
        if (x.status == 200) {
            var logArea = document.getElementById("log_text");
            logArea.innerHTML = "";
            logArea.innerHTML = "<pre>" + data.replace(/\n/g, "<br/>") + "</pre>";
        }
    });
}

function clearLog() {
    XHR.get('<%=url("admin/services/ddns-go/clear_log")%>', null, function(x, data) {
        if (x.status == 200) {
            fetchLog();
        }
    });
}

function toggleRefresh() {
    var btn = document.querySelector('input[onclick="toggleRefresh()"]');
    if (refreshInterval) {
        clearInterval(refreshInterval);
        refreshInterval = null;
        btn.value = "<%:Start Refresh%>";
    } else {
        refreshInterval = setInterval(fetchLog, 1000);
        btn.value = "<%:Stop Refresh%>";
    }
}

document.addEventListener('DOMContentLoaded', function() {
    fetchLog();
    toggleRefresh();
});
</script>
<%+footer%>